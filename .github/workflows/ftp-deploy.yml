name: Deploy Slim + React (Sem Build, Composer e FTP)

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: ‚¨áÔ∏è Checkout do C√≥digo
        uses: actions/checkout@v4

      # --- 1. Configura√ß√£o e Depend√™ncias PHP (Composer) ---
      - name: üêò Configurar PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: '8.2' # Ajustar √† vers√£o do Hostinger
          extensions: mbstring, zip, pdo_mysql
          coverage: none

      - name: üì¶ Instalar Depend√™ncias PHP (Composer)
        run: composer install --prefer-dist --no-dev --optimize-autoloader
        
      # --- 2. Deploy via FTP ---
      
      # A) Deploy do Front-end (conte√∫do de frontend/public/) para a raiz
      - name: ‚è´ Deploy do Front-end (index.html, bus_logos, icons)
        uses: SamKirkland/FTP-Deploy-Action@v4.3.0
        with:
          server: ${{ secrets.FTP_SERVER }}
          username: ${{ secrets.FTP_USERNAME }}
          password: ${{ secrets.FTP_PASSWORD }}
          # Envia o CONTE√öDO da pasta 'public' para a raiz
          local-dir: './frontend/public/' 
          remote-dir: '/' # Raiz do subdom√≠nio

      # B) Deploy do Backend (Slim e Composer) para a raiz
      - name: ‚è´ Deploy do Backend (Slim e vendor)
        uses: SamKirkland/FTP-Deploy-Action@v4.3.0
        with:
          server: ${{ secrets.FTP_SERVER }}
          username: ${{ secrets.FTP_USERNAME }}
          password: ${{ secrets.FTP_PASSWORD }}
          # Exclui o c√≥digo-fonte React / front-end que n√£o queremos na raiz
          exclude: |
            **/node_modules/**
            .git/
            .github/
            /frontend 
            /backend # Se quiser manter o backend num n√≠vel superior
          local-dir: './'
          remote-dir: '/'